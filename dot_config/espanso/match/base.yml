# Automatically generated by espanso migration tool
# Original file: default.yml

matches:
  - trigger: ":date"
    replace: "{{mydate}}"
    vars:
      - name: mydate
        type: date
        params:
          format: "%Y-%m-%d"
  - trigger: ":isodate"
    replace: "{{mydate}}"
    vars:
      - name: mydate
        type: date
        params:
          format: "%+"

  - trigger: ":pubkey"
    replace: "{{key}}"
    vars:
      - name: key
        type: shell
        params:
          cmd: op item list --categories 'SSH Key' --vault Employee --favorite --format=json | op item get - --fields public_key

  - trigger: ":hss"
    replace: 'tmuxer -c "hss {}"'

  - trigger: ":du -shx"
    replace: 'du -shx --exclude /proc --exclude /vbin /* | sort -rh'

  - trigger: ":o11yhelp"
    replace: 'Thanks for reaching out! Please be sure to tag @firechief-sre-o11y for any questions or help requests to ensure prompt attention'

  - trigger: ":amtoolr"
    replace: 'amtool config routes test --config.file=/etc/alertmanager/alertmanager.yml'

    # Salt
  - trigger: ":scache"
    replace: 'sudo salt-call --local saltutil.clear_cache; sudo salt-call saltutil.refresh_grains;'

  - trigger: ":highstate"
    replace: "sudo salt-call state.highstate --return prometheus_highstate,last_highstate_log --state-output=changes"

  - trigger: ":tshighstate"
    replace: cat /var/lib/prometheus/node-exporter/saltHighState.prom | tail -1 | awk '{split($2,a,"."); print a[1];}' | xargs -I % sh -c 'date -d @%'

  - trigger: ":hbactest"
    form: |
        ipa hbactest --user=[[user]] --service=[[service]] --host="$(hostname -f)"
    form_fields:
      service:
        type: choice
        values:
          - ssh
          - sudo
